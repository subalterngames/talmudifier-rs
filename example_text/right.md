The Talmud's typesetting dates back to the invention of the printing press. Printmaking was easy but paper was expensive so people crammed several texts onto a single page. The standard Talmud page layout is actually the Talmud as printed in the Vilna Shas, and other page layouts are possible. There are rules defining how to typeset a Talmud page. The Vilna Shas predates the formalization of iterative algorithms, so some pages follow the rules less strictly than others. Talmudifier strictly follows the following rules: 1. There are always three columns of text 2. Whenever possible, the page starts with four lines of text in the left and right columns followed by a gap row to give the center column some breating space: 3. After this, columns are typeset using the following algorithm until there is no more text: - Each column can have a different typeface (most famously, Rashi's commentary has its own typeface). - The widths of the columns are determined by which columns still have text. For example, if the left and right columns have text that needs to be typeset but the center column doesn't, then the column widths are each half of the total width of the table. - Find the column with the least number of lines (*n*). - Add all columns that still have text to the page up to *n* lines (or, if there isn't enough text, just add all remaining text). - Marginalia is always in-line with the text that it is commenting on. - For the columns that still have text, add gap rows. For more information, read: `Printing the Talmud : a history of the earliest printed editions of the Talmud by Martin Heller` There is a fundamental problem in the typesetting algorithm: We need to iteratively get the number of lines in a column. In LaTeX, there's no way to know the number of lines in a column until it's rendered. Therefore, Talmudifier uses the following algorithm: 1. Create a table that has text only in one column (the one we're trying to measure). 2. Generate a PDF with XeTeX in-memory. 3. Extract the text from the PDF. 4. Count the number of lines. 5. Add or subtract a word as needed, and repeat the process until the column is filled up to the target number of lines. This process is *slow* and it's why Talmudifier takes so long to render a page. Traditionally, this process would be sped up by experienced typesetters because they'd be able to eyeball how many character blocks would fit in a rectangle. Talmudifier also uses a heuristic to speed things up: Cosmic Text, a Rust crate meant for formatting text in a GUI app, renders the text, using the same algorithm as described above. Cosmic Text is *fast* and this algorithm returns a guess as to the total number of words in a column that Talmudifier then uses to start the TeX portion of the algorithm. Cosmic Text's guess is rarely exactly correct because Cosmic Text isn't TeX and will typeset blocks of text differently.